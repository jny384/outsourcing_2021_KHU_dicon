{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import storage from\"../firebase/firebase-manager\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function UploadWorkImages(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),images=_useState2[0],setImages=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),urls=_useState4[0],setUrls=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),clicked=_useState8[0],setClicked=_useState8[1];// const [directory, setDirectory] = useState(\"\");\nvar directory=props.directory;var teamName=props.teamName;var handleChange=function handleChange(e){if(images.length!=0){// console.log('a')\nsetImages([]);};var _loop=function _loop(i){var newImage=e.target.files[i];newImage[\"id\"]=Math.random();setImages(function(prevState){return[].concat(_toConsumableArray(prevState),[newImage]);});};for(var i=0;i<e.target.files.length;i++){_loop(i);}};// console.log(images)\n// const handleChangeDirectory = (e) => {\n//     setDirectory(e.target.value);\n// }\nvar handleUpload=function handleUpload(){setClicked(true);var promises=[];images.map(function(image){var uploadTask=storage.ref(\"images/\".concat(teamName,\"/\").concat(directory,\"/works/\").concat(image.name)).put(image);promises.push(uploadTask);uploadTask.on(\"state_changed\",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){console.log(error);},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return storage.ref(\"images/\".concat(teamName,\"/\").concat(directory,\"/works/\")).child(image.name).getDownloadURL().then(function(urls){setUrls(function(prevState){return[].concat(_toConsumableArray(prevState),[urls]);});// console.log(urls)\n});case 2:case\"end\":return _context.stop();}}},_callee);})));});Promise.all(promises)// .then(() => { })\n.catch(function(err){return console.log(err);});};// const initializeInput = () => {\n//     console.log('a')\n//     setImages([]);\n// }\n// console.log(\"image : \", images);\n// console.log(\"urls : \", urls);\nvar sendText=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return props.getWorksUrl(urls);case 2:_context2.next=4;return console.log('Works : ',urls);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function sendText(){return _ref2.apply(this,arguments);};}();// console.log(urls)\n// console.log(teamName)\n// console.log(directory)\nreturn/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"progress\",{value:progress,max:\"100\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{onClick:clicked?null:handleUpload,children:\"Upload\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendText,children:\"send\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),urls.map(function(url,i){return/*#__PURE__*/_jsx(\"img\",{src:url||\"http://via.placeholde.com/300\",alt:\"works\",style:{height:\"50px\"}},i);}),/*#__PURE__*/_jsx(\"br\",{})]});}","map":{"version":3,"sources":["/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/src/components/post/uploadWorkImages.js"],"names":["React","useState","storage","UploadWorkImages","props","images","setImages","urls","setUrls","progress","setProgress","clicked","setClicked","directory","teamName","handleChange","e","length","i","newImage","target","files","Math","random","prevState","handleUpload","promises","map","image","uploadTask","ref","name","put","push","on","snapshot","round","bytesTransferred","totalBytes","error","console","log","child","getDownloadURL","then","Promise","all","catch","err","sendText","getWorksUrl","url","height"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport storage from \"../firebase/firebase-manager\";\n\nexport default function UploadWorkImages(props) {\n    const [images, setImages] = useState([]);\n    const [urls, setUrls] = useState([]);\n    const [progress, setProgress] = useState(0);\n    const [clicked, setClicked] = useState(false);\n    // const [directory, setDirectory] = useState(\"\");\n    const directory = props.directory;\n    const teamName = props.teamName;\n\n    const handleChange = (e) => {\n        if (images.length != 0) {\n            // console.log('a')\n            setImages([])\n        };\n\n        for (let i = 0; i < e.target.files.length; i++) {\n            const newImage = e.target.files[i];\n            newImage[\"id\"] = Math.random();\n            setImages((prevState) => [...prevState, newImage]);\n        }\n    };\n    // console.log(images)\n    // const handleChangeDirectory = (e) => {\n    //     setDirectory(e.target.value);\n    // }\n\n    const handleUpload = () => {\n        setClicked(true);\n        const promises = []\n        images.map((image) => {\n            const uploadTask = storage.ref(`images/${teamName}/${directory}/works/${image.name}`).put(image);\n            promises.push(uploadTask);\n            uploadTask.on(\n                \"state_changed\",\n                (snapshot) => {\n                    const progress = Math.round(\n                        (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n                    );\n                    setProgress(progress);\n                },\n                (error) => {\n                    console.log(error);\n                },\n                async () => {\n                    await storage\n                        .ref(`images/${teamName}/${directory}/works/`)\n                        .child(image.name)\n                        .getDownloadURL()\n                        .then((urls) => {\n                            setUrls((prevState) => [...prevState, urls]);\n                            // console.log(urls)\n                        })\n                }\n            );\n        });\n\n        Promise.all(promises)\n            // .then(() => { })\n            .catch((err)=> console.log(err))\n    };\n    // const initializeInput = () => {\n    //     console.log('a')\n    //     setImages([]);\n    // }\n\n    // console.log(\"image : \", images);\n    // console.log(\"urls : \", urls);\n\n    const sendText = async () => {\n        // handleUpload()\n        await props.getWorksUrl(urls);\n        await console.log('Works : ',urls)\n    }\n    // console.log(urls)\n    // console.log(teamName)\n    // console.log(directory)\n    return(\n        <>\n            <progress value={progress} max=\"100\"/>\n            <br/>\n            {/*<input onChange={handleChangeDirectory} placeholder=\"저장 폴더 이름\"/>*/}\n            <br/>\n            <input type=\"file\" multiple onChange={handleChange}/>\n            <button onClick={clicked ? null: handleUpload}>Upload</button>\n            <button onClick={sendText}>send</button>\n            <br/>\n            <br/>\n            {urls.map((url, i) => (\n                <img key={i}\n                     src={url || \"http://via.placeholde.com/300\"}\n                     alt=\"works\"\n                     style={{height: \"50px\"}}\n                />\n            ))}\n            <br/>\n            {/*<GetWorkImages urls={urls}/>*/}\n        </>\n    )\n}"]},"metadata":{},"sourceType":"module"}