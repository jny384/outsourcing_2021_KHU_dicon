{"ast":null,"code":"import _regeneratorRuntime from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState}from\"react\";import storage from\"../firebase/firebase-manager\";// import GetWorkImages from \"./getWorkImages\";\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function UploadWorkImages(props){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),images=_useState2[0],setImages=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),urls=_useState4[0],setUrls=_useState4[1];var _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),progress=_useState6[0],setProgress=_useState6[1];// const [directory, setDirectory] = useState(\"\");\nvar directory=props.directory;var teamName=props.teamName;var handleChange=function handleChange(e){var _loop=function _loop(i){var newImage=e.target.files[i];newImage[\"id\"]=Math.random();setImages(function(prevState){return[].concat(_toConsumableArray(prevState),[newImage]);});};for(var i=0;i<e.target.files.length;i++){_loop(i);}};// const handleChangeDirectory = (e) => {\n//     setDirectory(e.target.value);\n// }\nvar handleUpload=function handleUpload(){var promises=[];images.map(function(image){var uploadTask=storage.ref(\"images/\".concat(teamName,\"/\").concat(directory,\"/works/\").concat(image.name)).put(image);promises.push(uploadTask);uploadTask.on(\"state_changed\",function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setProgress(progress);},function(error){console.log(error);},/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return storage.ref(\"images/\".concat(teamName,\"/\").concat(directory,\"/works/\")).child(image.name).getDownloadURL().then(function(urls){setUrls(function(prevState){return[].concat(_toConsumableArray(prevState),[urls]);});// console.log(urls)\n});case 2:case\"end\":return _context.stop();}}},_callee);})));});Promise.all(promises)// .then(() => { })\n.catch(function(err){return console.log(err);});};// console.log(\"image : \", images);\n// console.log(\"urls : \", urls);\nvar sendText=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return props.getWorksUrl(urls);case 2:_context2.next=4;return console.log(urls);case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function sendText(){return _ref2.apply(this,arguments);};}();// console.log(urls)\nconsole.log(teamName);console.log(directory);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"progress\",{value:progress,max:\"100\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,onChange:handleChange}),/*#__PURE__*/_jsx(\"button\",{onClick:handleUpload,children:\"Upload\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendText,children:\"send\"}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),urls.map(function(url,i){return/*#__PURE__*/_jsx(\"img\",{src:url||\"http://via.placeholde.com/300\",alt:\"works\",style:{height:\"50px\"}},i);}),/*#__PURE__*/_jsx(\"br\",{})]});}","map":{"version":3,"sources":["/Users/jeongnayeong/Desktop/2021_KHU_dicon_/outsourcing_2021_KHU_dicon/src/components/post/uploadWorkImages.js"],"names":["React","useState","storage","UploadWorkImages","props","images","setImages","urls","setUrls","progress","setProgress","directory","teamName","handleChange","e","i","newImage","target","files","Math","random","prevState","length","handleUpload","promises","map","image","uploadTask","ref","name","put","push","on","snapshot","round","bytesTransferred","totalBytes","error","console","log","child","getDownloadURL","then","Promise","all","catch","err","sendText","getWorksUrl","url","height"],"mappings":"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","sourcesContent":["import React, {useState} from \"react\";\nimport storage from \"../firebase/firebase-manager\";\n// import GetWorkImages from \"./getWorkImages\";\n\nexport default function UploadWorkImages(props) {\n    const [images, setImages] = useState([]);\n    const [urls, setUrls] = useState([]);\n    const [progress, setProgress] = useState(0);\n    // const [directory, setDirectory] = useState(\"\");\n    const directory = props.directory;\n    const teamName = props.teamName;\n    \n    const handleChange = (e) => {\n        for (let i = 0; i < e.target.files.length; i++) {\n            const newImage = e.target.files[i]\n            newImage[\"id\"] = Math.random();\n            setImages((prevState) => [...prevState, newImage]);\n        }\n    };\n\n    // const handleChangeDirectory = (e) => {\n    //     setDirectory(e.target.value);\n    // }\n\n    const handleUpload = () => {\n        const promises = []\n        images.map((image) => {\n            const uploadTask = storage.ref(`images/${teamName}/${directory}/works/${image.name}`).put(image);\n            promises.push(uploadTask);\n            uploadTask.on(\n                \"state_changed\",\n                (snapshot) => {\n                    const progress = Math.round(\n                        (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n                    );\n                    setProgress(progress);\n                },\n                (error) => {\n                    console.log(error);\n                },\n                async () => {\n                    await storage\n                        .ref(`images/${teamName}/${directory}/works/`)\n                        .child(image.name)\n                        .getDownloadURL()\n                        .then((urls) => {\n                            setUrls((prevState) => [...prevState, urls]);\n                            // console.log(urls)\n                        })\n                }\n            );\n        });\n\n        Promise.all(promises)\n            // .then(() => { })\n            .catch((err)=> console.log(err))\n    };\n\n    // console.log(\"image : \", images);\n    // console.log(\"urls : \", urls);\n\n    const sendText = async () => {\n        // handleUpload()\n        await props.getWorksUrl(urls);\n        await console.log(urls)\n    }\n    // console.log(urls)\n    console.log(teamName)\n    console.log(directory)\n    return(\n        <>\n            <progress value={progress} max=\"100\"/>\n            <br/>\n            {/*<input onChange={handleChangeDirectory} placeholder=\"저장 폴더 이름\"/>*/}\n            <br/>\n            <input type=\"file\" multiple onChange={handleChange}/>\n            <button onClick={handleUpload}>Upload</button>\n            <button onClick={sendText}>send</button>\n            <br/>\n            <br/>\n            {urls.map((url, i) => (\n                <img key={i}\n                     src={url || \"http://via.placeholde.com/300\"}\n                     alt=\"works\"\n                     style={{height: \"50px\"}}\n                />\n            ))}\n            <br/>\n            {/*<GetWorkImages urls={urls}/>*/}\n        </>\n    )\n}"]},"metadata":{},"sourceType":"module"}